// Shoot particles through ExtMonFNAL detector.
//
// Andrei Gaponenko, 2011

#include "minimalMessageService.fcl"
#include "standardProducers.fcl"
#include "standardServices.fcl"

// Give this job a name.
process_name : extMonFNALReconstruction

source : { module_type : RootInput }

services : {
    message : @local::default_message

    scheduler: { defaultExceptions : false }
    TFileService : { fileName : "hists_extMonFNALReconstruction.root" }

    user : {
        ConditionsService : { conditionsfile : "Mu2eG4/test/conditions_01.txt" }
        GlobalConstantsService : { inputFile : "Mu2eG4/test/globalConstants_01.txt" }
    }
}

physics : {
    producers : {
        pixelRawClusterization : @local::pixelRawClusterization
        pixelRecoClusterization : @local::pixelRecoClusterization
        pixelRecoClusterTruthMaking : @local::pixelRecoClusterTruthMaking
        EMFPatRecSequential : @local::EMFPatRecSequential
        EMFPatRecSequentialTruthMaking : @local::EMFPatRecSequentialTruthMaking
        EMFPatRecFromTracklets : @local::EMFPatRecFromTracklets
        EMFPatRecFromTrackletsTruthMaking : @local::EMFPatRecFromTrackletsTruthMaking
    }

    analyzers: {
        EMFPatRecSequentialAnalysis : {
            module_type : EMFDetHistPatRec
            patRecModuleLabel : "EMFPatRecSequential"
            trkTruthModuleLabel : "EMFPatRecSequentialTruthMaking"
            clusterTruthModuleLabel : "pixelRecoClusterTruthMaking"
            particleModuleLabel : "g4run"
            geomModuleLabel : "geom"

            cutParticleMinClusters : 6
            cutParticleMaxAngle : 0.015
        }
        EMFPatRecFromTrackletsAnalysis : {
            module_type : EMFDetHistPatRec
            patRecModuleLabel : "EMFPatRecFromTracklets"
            trkTruthModuleLabel : "EMFPatRecFromTrackletsTruthMaking"
            clusterTruthModuleLabel : "pixelRecoClusterTruthMaking"
            particleModuleLabel : "g4run"
            geomModuleLabel : "geom"

            cutParticleMinClusters : 6
            cutHitXmax : 15 // mm
            cutHitYmax : 15 // mm

            cutMinCommonClusters : 6

        }
        hitValidation: {
            module_type: EMFRawHitsValidator
            inputModuleLabel : "pixelDigitization"
            inputInstanceName : ""
            geomModuleLabel : "geom"
            geomInstanceName : ""
        }
        printRecoClusterTruth : {
            module_type : EMFDetPrintRecoClusterTruth
            clusterModuleLabel : "" // "pixelRecoClusterization"
            truthModuleLabel : "pixelRecoClusterTruthMaking"
            particleModuleLabel : "g4run"
            cutMinClustersPerParticle : 6
        }
        emfRecoClusters: {
            module_type: EMFDetHistRecoClusters
            inputModuleLabel  : "pixelRecoClusterization"
            geomModuleLabel  : "geom"
        }
    }

    tprint : [ pixelRawClusterization
               , pixelRecoClusterization, pixelRecoClusterTruthMaking
               //, EMFPatRecSequential, EMFPatRecSequentialTruthMaking
               , EMFPatRecFromTracklets, EMFPatRecFromTrackletsTruthMaking
             ]

    //eprint: [ printRecoClusterTruth ]
    eprint: [ hitValidation, emfRecoClusters,
              //EMFPatRecSequentialAnalysis,
              EMFPatRecFromTrackletsAnalysis ]

    out : [FullOutput]

    trigger_paths  : [tprint]
    end_paths : [eprint, out]
}

outputs: {
    FullOutput : {
        module_type : RootOutput
        fileName    : "extMonFNALReconstruction.root"
  }
}

// somewhat reduce the amount of "volatile" printouts
services.message.destinations.log.noTimeStamps : true
services.message.statistics.noTimeStamps : true

//tuning: physics.producers.EMFPatRecFromTracklets.singleParticleMode : true
//tuning: physics.analyzers.EMFPatRecFromTrackletsAnalysis.singleParticleMode : true
//tuning: physics.analyzers.EMFPatRecFromTrackletsAnalysis.singleParticleClusterModuleLabel : pixelRecoClusterization

// This tells emacs to view this file in the JavaScript mode.
// Local Variables:
// mode:js
// End:
