// Simulate protons on target for ExtMonFNAL
//
// Andrei Gaponenko, 2011

#include "minimalMessageService.fcl"
#include "standardProducers.fcl"
#include "standardServices.fcl"

// Give this job a name.
process_name : g4s2ExtMonFNAL

source: {
    module_type: RootInput
    fileNames: ["gvdCommon.root"]
    maxEvents: -1
}

services : {
    //message : @local::mf_production
    message : @local::default_message

    scheduler: { defaultExceptions : false }
    TFileService : { fileName : "g4s2hists_ExtMonFNAL.root" }
    RandomNumberGenerator : {}

    user : {
        GeometryService : { inputFile : "ExtinctionMonitorFNAL/test/geom_extMonFNALs2.txt" }
        ConditionsService : { conditionsfile : "Mu2eG4/test/conditions_01.txt" }
        GlobalConstantsService : { inputFile : "Mu2eG4/test/globalConstants_01.txt" }
        SeedService       : @local::automaticSeeds
        G4Helper : { }
    }
}

physics : {
    producers : {
        fromVD16: {
            module_type: FromStepPointMCs
            inputModuleLabel : "fvd16"
            inputInstanceName : ""
            //logLevel : 2
        }

        g4run : {
            module_type          : G4
            generatorModuleLabel : fromVD16
        }

        # Save state of the random number engines.
        randomsaver : @local::randomsaver

        geoms2 : { module_type : GeometryRecorder }
    }

    filters: {
        emfd: {
            module_type: FilterVDHits
            inputModuleLabel   : "g4run"
            inputInstanceName  : "virtualdetector"
            acceptedVids       : [ 36 ] // 35 will go to "extra" hits
            storeParents       : true
            storeExtraHits     : true
        }
    }

    td : [fromVD16, g4run, emfd, randomsaver ]
    gm : [ geoms2 ]

    ed : [ outemfd, fullOutput ]
    //e16 : [ outemfd ]

    trigger_paths  : [gm, td]
    end_paths      : [ed]
}

outputs:
{
    outemfd: {
        module_type: RootOutput
        fileName: "extMonFNALDetectorVD.root"
        SelectEvents: { SelectEvents: [td] }
        outputCommands:   [ "keep *_emfd_*_*", "keep *_randomsaver_*_*", "keep *_geom_*_*" ]
    }

    fullOutput :
    {
        module_type   :   RootOutput
        fileName      :   "data_extMonFNALs2.root"
    }
}

// Limit the amount of "Begin processing the ... record" messages
services.message.destinations.log.categories.ArtReport.reportEvery : 1
services.message.destinations.log.categories.ArtReport.limit : 1
services.message.destinations.log.categories.ArtReport.timespan : 60
