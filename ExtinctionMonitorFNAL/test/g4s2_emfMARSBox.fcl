#include "ExtinctionMonitorFNAL/test/marsInputs_monfnal3w1.fcl"
#include "ExtinctionMonitorFNAL/test/extMonFNALDefsCommon.fcl"

source : {
    module_type : EmptyEvent
    maxEvents : 5
}

physics.producers.generate : {
    module_type: ExtMonFNALBoxGenerator
    verbosityLevel : 1

    // The 20121002a-EMFBoxFluxAnalyzer set corresponds to
    // 500(p/evt)*60(evts/job)*2999(jobs) MARS-passed protons on target
    //
    // MARS efficiency is (19382 / 40M), and microbunch is 30M protons
    // So the dateset represents (500*60*2999)/(19382 * 3/4) = 6189 microbunches
    // and the scaling factor is 1/6189.
    // For the whole dataset we'd have
    //
    //      microbunchScaling : 0.00016157
    //
    // But too much memory is needed to hold all the inputs
    // (grid jobs grew >4GB), so ExtinctionMonitorFNAL/test/20121004-grid-config/
    // contains config files to process pieces of the s1 dataset.

    //test: inputFiles : ["data/sum200files.root"]
    //test: microbunchScaling : 0.0243

    weightMax : 2

    bunchTimeHalfWidth : 100
    cutTimeMin : 120
    cutTimeMax : 1664 // 1694 + 70 - 100

    // don't throw partiles outside of the original VD box
    keepInBox : [ 100, 200, 650. ]

    geomModuleLabel : ""
}

physics.producers.pixelDigitization : @local::pixelDigitization

physics.filters.pixHitFilter : {
    module_type: EMFPixelHitsFilter
    rawHitsModuleLabel: pixelDigitization
    simParticlesModuleLabel : g4run
    cutMinHits: 1
}

physics.analyzers.emfprinttruth: {
    module_type: EMFDetPrintRawHitTruth
    hitsModuleLabel  : "pixelDigitization"
    truthModuleLabel : "pixHitFilter"
}
physics.print : [emfprinttruth]

physics.producers.g4run.generatorModuleLabel : "generate"
physics.producers.geoms2: { module_type : GeometryRecorder }
physics.gm : [geoms2]

physics.trigFilter : [ generate, g4run, pixelDigitization, pixHitFilter ]

//----------------------------------------------------------------
process_name : g4s2EMFMARSBox
//services.Timing : {}

services.user.GeometryService.inputFile : "ExtinctionMonitorFNAL/test/geom_s2EMFMARSRoom.txt"

services.TFileService.fileName : "hg4s2EMFMARSBox.root"

outputs.outFiltered : { module_type : RootOutput
                        SelectEvents: { SelectEvents: [trigFilter] }
                        outputCommands:   [ "keep *_pixHitFilter*_*_*", "keep mu2e::ExtMonFNALRawHits_pixelDigitization_*_*", "keep *_geom*_*_*" ]
                        fileName: "vdg4s2EMFMARSBoxFiltered.root"
                      }

physics.marsOutputs : [ outFiltered ]
//physics.end_paths : [marsOutputs, print]
physics.end_paths : [marsOutputs]

services.user.SeedService.baseSeed         :  0
services.user.SeedService.maxUniqueEngines :  20

//physics.producers.g4run.visMacro : "ExtinctionMonitorFNAL/test/vis_extMonFNALDetector.mac"

// This tells emacs to view this file in the JavaScript mode.
// Local Variables:
// mode:js
// End:
