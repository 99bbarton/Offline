#include "minimalMessageService.fcl"
#include "standardProducers.fcl"
#include "standardServices.fcl"

process_name: testFromStepPointMCs

source: {
    module_type: RootInput
    fileNames: ["data_bkg.root"]
    maxEvents: -1
}

services: {

    message: @local::default_message
   
    TFileService :
    {
      fileName      : "TestSP.root"
    }

    RandomNumberGenerator : { }

    user: {
     
    GeometryService :
    {
      inputFile : "Mu2eG4/test/geom_01.txt"
    }

    ConditionsService :
    {
      conditionsfile : "Mu2eG4/test/conditions_01.txt"
    }

    GlobalConstantsService : { inputFile : "Mu2eG4/test/globalConstants_01.txt" }

    G4Helper : { }

    SeedService: @local::automaticSeeds

  
  }
}

physics: {

    producers: {

    SPEP: 
       {
            module_type: FromSimParticleEndPoint
            inputModuleLabel : "g4run"
            inputPdgIds : [-211]
            inputVolumes : ["TargetFoil"]
	    inputProcessCode : "nCapture"	
   	    outputGenId: "PiCaptureCombined"
        }

    # Run G4 and add hits to the event
    g4run2 : @local::g4run

    # Form StrawHits (SH).
    makeSH2 : @local::makeSH

    # Form CaloHits (APD hits)
    CaloReadoutHitsMaker2 : @local::CaloReadoutHitsMaker

    # Form CaloCrystalHits (reconstruct crystals from APDs)
    CaloCrystalHitsMaker2 : @local::CaloCrystalHitsMaker

}

    p1: [SPEP, g4run2, makeSH2, CaloReadoutHitsMaker2, CaloCrystalHitsMaker2]
    e1: [outfile2]

	trigger_paths  :  [p1]
	end_paths      :  [e1]
}


outputs:
{
  # Define the output file.
  outfile2 : 
  {
    module_type    : RootOutput
    fileName       : "data_SPEP.root"
    fastCloning    : false
    outputCommands : ['keep *_*_*_*'
                #   , 'drop mu2ePointTrajectoryMapVector_*_*_*'
                #   , 'drop mu2eSimParticles_*_*_*'
                   # Uncomment the above line to reduce file size.
                     ]  
  }
}


services.user.SeedService.baseSeed         :  0
services.user.SeedService.maxUniqueEngines :  20
physics.producers.makeSH2.g4ModuleLabel    :  g4run2
physics.producers.CaloReadoutHitsMaker2.g4ModuleLabel    :  g4run2
physics.producers.CaloCrystalHitsMaker2.g4ModuleLabel    :  g4run2
physics.producers.g4run2.generatorModuleLabel   :  SPEP