#
#  This script runs hit and track reconstruction on a file containing StepPointMCs
# for example, the command
#  > mu2e --config TrkPatRec/test/TrkPatRecTestRead.fcl /pnfs/mu2e/scratch/outstage/gandr/3028848.beam-g4s4-conversion/00000/sim.mu2e.cd3-beam-g4s4-detconversion.0918a.004001_00000000.art --nevts=100
#
# will read 100 CD3 CE events, reconstruct the tracks, and produce the standard KalDiag TTree for those track
#
# David Brown, 13 Nov, 2015
#
#include "minimalMessageService.fcl"
#include "standardProducers.fcl"
#include "standardServices.fcl"
#include "KalmanTests/fcl/KalDiag.fcl"

process_name : TrkPatRecTest

source :
{
  module_type : RootInput
}

services :
{
  message : @local::default_message
  TFileService : { fileName : "TrkPatRecTestRead.root" }
  RandomNumberGenerator: { }
  GeometryService        : { inputFile : "Mu2eG4/test/geom_cd3.txt" }
  ConditionsService : { conditionsfile : "Mu2eG4/test/conditions_01.txt" }
  GlobalConstantsService : { inputFile : "Mu2eG4/test/globalConstants_01.txt" }
  user : { 
    SeedService: @local::automaticSeeds
  }
  G4Helper               : { }
  BTrkHelper : @local::BTrkHelperDefault
}

physics :
{
  producers : {
    @table::EventMixing.producers
    @table::Tracking.producers
  }
  analyzers : {
# count generated events
      genCountLogger : { module_type: GenEventCountReader }
# read Kalman fit DownstreameMinus tracks and create default KalDiag TTree
# Note that the module labels and keys for the data products may be different
# if you are reading files.
      RKFDownstreameMinus: {
         module_type : ReadKalFits
         fitterModuleLabel : TRFDownstreameMinus
	 KalDiag : @local::KalDiagReadCD3 # configure KalDiag to look for CD3 data products
      }
   }
# trigger path; this creates hits from MCSteps, then reconstructs the tracks
p1: [ 	@sequence::EventMixing.TimeMaps,
	@sequence::Tracking.DigiSim,
	@sequence::Tracking.TPRDownstreameMinus ]
# end path
  e1 : [RKFDownstreameMinus, genCountLogger]
  
  trigger_paths  : [p1]
  end_paths      : [e1]
}

# the following are needed for interactive running.  They will be overwritten if you submit this job
# on the grid with mu2eart and do not need to be removed.
services.user.SeedService.baseSeed         :  773651
services.user.SeedService.maxUniqueEngines :  20

