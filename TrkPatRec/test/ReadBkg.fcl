#
#  This script reads CD3 premixed background frames as primary events
#  
# David Brown, 19 April 2016
#
#include "minimalMessageService.fcl"
#include "standardProducers.fcl"
#include "standardServices.fcl"
#include "TrkDiag/fcl/KalDiag.fcl"

process_name : ReadBkg

source :
{
  module_type : RootInput
}

services :
{
  message : @local::default_message
  TFileService : { fileName : "ReadBkg.root" }
  RandomNumberGenerator: { }
  GeometryService        : { inputFile : "Mu2eG4/test/geom_01.txt" }
  ConditionsService : { conditionsfile : "Mu2eG4/test/conditions_01.txt" }
  GlobalConstantsService : { inputFile : "Mu2eG4/test/globalConstants_01.txt" }
  user : { 
    SeedService: @local::automaticSeeds
  }
  G4Helper               : { }
  BTrkHelper : @local::BTrkHelperDefault
}

physics :
{
  producers : {
    @table::EventMixing.producers
    @table::Tracking.producers
  }
  analyzers : {
# count generated events
      genCountLogger : { module_type: GenEventCountReader }
# read Kalman fit DownstreameMinus tracks and create default KalDiag TTree
# Note that the module labels and keys for the data products may be different
# if you are reading files.
      RKFDownstreameMinus: {
         module_type : ReadKalFits
         fitterModuleLabel : TRFDownstreameMinus
	 KalDiag : @local::KalDiagReadCD3 # configure KalDiag to look for CD3 beam data products
#	 KalDiag : @local::KalDiagReadCD3Cosmics # configure KalDiag to look for CD3 cosmic data products
	 eventWeightModules : [ protonBunchSummarizer  ]
	 beamWeightModule : protonBunchSummarizer
	 processEmpty : false
      }
   }
# trigger path; create time maps, add proton bunch weight, simulate digis and reconstruct tracks
  p1: [ @sequence::EventMixing.TimeMaps,
	protonBunchSummarizer,
	@sequence::Tracking.DigiSim,
	@sequence::Tracking.TPRDownstreameMinus ]
# end path
  e1 : [RKFDownstreameMinus, genCountLogger]
  
  trigger_paths  : [p1]
  end_paths      : [e1]
}

# the following are needed for interactive running.  They will be overwritten if you submit this job
# on the grid with mu2eart and do not need to be removed.
services.user.SeedService.baseSeed         :  773651
services.user.SeedService.maxUniqueEngines :  20

