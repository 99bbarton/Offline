#! /bin/sh
#
# Script to create a test release based on the current base release.
# Arguments are interpertted as the names of new packages to create.
#
#  $Id: createTestRelease,v 1.1 2011/05/12 22:46:19 kutschke Exp $
#  $Author: kutschke $
#  $Date: 2011/05/12 22:46:19 $
#

if [ "${MU2E_BASE_RELEASE}" = '' ];then
    echo "The environment variable MU2E_BASE_RELEASE is not set."
    echo "You must setup a base release before sourcing this script."
    exit
fi

# Make sure that we will not overwrite existing files.
for stuff in SConstruct setup.sh bin $*
do
if [ -e ${stuff} ];then
   echo "The file or directory " $stuff " already exists."
   echo "Please clean up and restart."
   echo "Stopping now."
   exit
fi
done

# All OK, do the work.

# Copy some files from the base release.
cp ${MU2E_BASE_RELEASE}/SConstruct .
mkdir -p bin
cp ${MU2E_BASE_RELEASE}/bin/setup_mu2e_project.sh bin
cp ${MU2E_BASE_RELEASE}/bin/addlocal.sh           bin

# Create the setup script for the test release.
# Hard code the path to the base release.
cat >> setup.sh <<EOF
#! /bin/sh

# Connect to the base release.
source $MU2E_BASE_RELEASE/setup.sh

# Add the test release to PATH, LD_LIBRARY_PATH and PYTHON_PATH
source bin/setup_mu2e_project.sh

# Define the test release environment variables.
source bin/addlocal.sh

EOF

# Make the subdirectories for new packages.
for dir in $*
do
 newPackage ${dir}
done
